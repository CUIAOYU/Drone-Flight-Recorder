# Verilog Flight Recorder

## 项目简介

这个仓库包含一个用Verilog实现的简易数字“飞行记录仪”模块。它的核心功能是捕获一连串的数据输入，将其存入内部存储区，并根据指令回放这些数据。

整个模块由一个简单的状态机驱动，可以处理记录、回放、停止和空闲等状态，并提供了直观的LED状态指示。

## 核心功能

*   **数据记录与回放**: 模块可以按指令开始记录数据，并在记录结束后，根据需要进行回放。
*   **状态机控制**: 内部逻辑由一个四状态（`IDLE`, `RECORDING`, `PLAYBACK`, `ERROR`）的状态机管理，保证了操作的清晰和稳定。
*   **参数化设计**: 模块的数据位宽 (`DATA_WIDTH`) 和存储深度 (`MAX_STORAGE_ADDRESS`) 都是可配置的参数，方便在不同场景下例化。
*   **指令式操作**: 模块的运行由几个单周期脉冲信号 (`RECORD_CMD`, `PLAYBACK_CMD`, `STOP_CMD`) 控制，接口简洁明了。
*   **状态指示**: 通过三个独立的LED信号（`GreenLED`, `BlueLED`, `RedLED`）来实时反馈模块当前是正在记录、正在回放，还是遇到了存储已满等情况。

## 模块接口

### 参数

| 参数 | 默认值 | 描述 |
| :--- | :--- | :--- |
| `DATA_WIDTH` | 32 | 数据总线的位宽。 |
| `ADDR_WIDTH` | 10 | 存储器地址总线的位宽。 |
| `MAX_STORAGE_ADDRESS` | 1024 | 内部存储器的最大深度，决定了能记录多少条数据。 |

### 端口

| 端口 | 方向 | 宽度 | 描述 |
| :--- | :--- | :--- | :--- |
| `clk` | Input | 1 | 系统时钟。 |
| `rst` | Input | 1 | 高电平有效，同步复位。 |
| `MODE_SELECT` | Input | 1 | **保留端口**，为未来功能扩展预留，当前逻辑中未使用。 |
| `RECORD_CMD` | Input | 1 | **记录指令**。一个高电平脉冲即可触发记录。 |
| `PLAYBACK_CMD` | Input | 1 | **回放指令**。一个高电平脉冲即可触发回放。 |
| `STOP_CMD` | Input | 1 | **停止指令**。一个高电平脉冲可以中断当前的记录或回放。 |
| `sensor_din` | Input | `DATA_WIDTH` | 需要被记录的外部传感器数据。 |
| `GreenLED` | Output | 1 | **绿灯**。记录（`RECORDING`）时点亮。 |
| `BlueLED` | Output | 1 | **蓝灯**。回放（`PLAYBACK`）时点亮。 |
| `RedLED` | Output | 1 | **红灯**。当存储写满或出现错误时点亮。 |
| `data_out` | Output | `DATA_WIDTH` | 回放时输出的数据。 |
| `data_out_valid` | Output | 1 | `data_out`的有效指示信号，在回放期间持续为高。 |

## 工作机制

模块的核心是一个简单的状态机，其行为如下：

1.  **IDLE (空闲)**: 模块的初始和待机状态。在这里，它等待 `RECORD_CMD` 或 `PLAYBACK_CMD` 指令。

2.  **RECORDING (记录)**:
    *   在`IDLE`状态下，一个 `RECORD_CMD` 脉冲会使模块进入此状态，同时点亮绿灯。
    *   在每个时钟周期，模块会捕获 `sensor_din` 上的数据并存入BRAM，写地址自动递增。
    *   当收到 `STOP_CMD` 指令，或当存储空间被写满时，模块会自动停止并返回 `IDLE` 状态。此时，模块会记住这次总共记录了多少数据。

3.  **PLAYBACK (回放)**:
    *   在`IDLE`状态下，如果之前有过记录，一个 `PLAYBACK_CMD` 脉冲会启动回放流程，同时点亮蓝灯。
    *   模块会从头开始，在每个时钟周期通过 `data_out` 输出一条记录，同时拉高 `data_out_valid`。
    *   当所有记录的数据都回放完毕，或收到 `STOP_CMD` 指令，模块会自动返回 `IDLE` 状态。

4.  **ERROR (错误)**:
    *   这是一个定义好的状态，但当前设计主要通过 `RedLED` 来指示具体问题，例如内存写满。这个状态为将来更复杂的错误处理逻辑预留了空间。

## 仿真与测试

项目自带了一个完整的Testbench (`flight_recorder_tb.v`)，用于验证模块的功能。

测试脚本覆盖了以下主要场景：
*   正常的 **记录 -> 停止 -> 回放** 流程。
*   回放结束后，模块能自动返回空闲状态。
*   将存储器**完全写满**，验证 `MemoryFull` 和 `RedLED` 的行为是否正确。
*   验证各个状态下，指针和LED指示灯的正确性。

### 如何运行仿真

1.  将 `flight_recorder.v` 和 `flight_recorder_tb.v` 添加到你的Verilog仿真工具（如Vivado）中。
2.  将 `flight_recorder_tb` 设为顶层仿真模块。
3.  运行仿真。
    *   Testbench中包含一个 `$monitor` 任务，它会在仿真过程中持续打印所有关键信号的状态，方便直接在控制台进行调试和跟踪。
